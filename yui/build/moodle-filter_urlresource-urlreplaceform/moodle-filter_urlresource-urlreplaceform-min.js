YUI.add("moodle-filter_urlresource-urlreplaceform",function(e,t){M.filter_urlresource=M.filter_urlresource||{},M.filter_urlresource.urlreplaceforminit=function(t){"use strict";function r(t,r,i){if(n)return!1;n=!0;var s=M.cfg.wwwroot+"/filter/urlresource/ajax.php",o=M.util.add_spinner(e,r);e.io(s,{data:t,on:{start:function(){o.show()},success:function(t,r){try{var s=e.JSON.parse(r.responseText);i(s),n=!1,o.hide()}catch(u){}},failure:function(){n=!1,o.hide()}}})}function a(){return t.urlimgs.length==0?!1:(u=1,t.offset+1>=t.urlimgs.length&&(t.offset=-1),i.set("src",t.urlimgs[t.offset+1]),!0)}function f(){return t.urlimgs.length==0?!1:(u=0,t.offset-1>=t.urlimgs.length&&(t.offset=-1),i.set("src",t.urlimgs[t.offset-1]),!0)}function l(){t.urlimgs.splice(t.offset+1,1),a()}function c(){var n=0;if(i.get("width")){n=i.get("width");if(n<20)return t.urlimgs.splice(t.offset+1,1),a()}return u==1?(t.offset=t.offset+1,e.one("#imgsrc").setHTML(t.urlimgs[t.offset+1]),s.set("value",t.urlimgs[t.offset+1])):(t.offset=t.offset-1,e.one("#imgsrc").setHTML(t.urlimgs[t.offset-1]),s.set("value",t.urlimgs[t.offset-1])),i.show(),!0}function h(){var n={};n.action="loadnewimages",n.courseid=t.courseid,n.url=e.one("#id_externalurl").get("value"),r(n,i.ancestor(),function(e){p(e)})}function p(n){if(n.error==0){var r=y(n.title);t.urlimgs=n.imgurls,e.one("#id_title").set("value",r),a(),o=1}else alert("check url")}function d(){o>0?a():h()}function v(){o>0?f():h()}function m(){o=0,i.set("src",""),i.hide(),e.one("#imgsrc").setHTML(""),s.set("value",""),t.urlimgs=[],t.offset=-1}function g(){o>0&&m()}function y(e){return typeof e=="string"&&(new RegExp(/&amp;|&lt;|&gt;|&quot;|&#39;/)).test(e)?e.replace(/&amp;/g,"&").replace(/&lt/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'"):e}function b(){e.one("#id_externalurl").on("change",function(e){g(),h()}),e.one("#refreshimages").on("click",function(e){e.preventDefault(),h()}),e.one("#nextimage").on("click",function(e){e.preventDefault(),d()}),e.one("#previmage").on("click",function(e){e.preventDefault(),v()}),i=e.one("#imgpreview"),i.on("load",function(){c()}),i.on("error",function(){l()}),s=e.one("#imgurl"),t.urlimgs.length>0?o=1:m()}var n=!1,i,s,o=0,u=0;b()}},"@VERSION@",{requires:["base","node"]});
